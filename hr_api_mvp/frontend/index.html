<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Employee Leave Portal (MVP)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f7fb; color: #111; }
    .container { max-width: 900px; margin: 2rem auto; padding: 1rem; }
    .card { background: white; border-radius: 16px; padding: 1.25rem; box-shadow: 0 10px 25px rgba(0,0,0,.08); margin-bottom: 1rem; }
    label { font-weight: 600; display:block; margin: .25rem 0; }
    input, select, button, textarea {
      width: 100%; padding: .75rem .9rem; border: 1px solid #d8dbe3; border-radius: 12px; font-size: 1rem;
      box-sizing: border-box; background: #fff;
    }
    button { cursor: pointer; border: none; background: #4f46e5; color: #fff; font-weight: 600; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .row { display: grid; grid-template-columns: repeat(2,1fr); gap: .75rem; }
    .row3 { display: grid; grid-template-columns: repeat(3,1fr); gap: .75rem; }
    .muted { color: #666; font-size: .9rem; }
    pre { background: #0b1020; color: #e1e8ff; padding: .75rem; border-radius: 12px; overflow:auto; }
    .pill { display:inline-block; padding:.25rem .5rem; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:.85rem; font-weight:600; }
    .flex { display:flex; gap:.5rem; align-items:center; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h2>Employee Leave Portal (MVP)</h2>
      <p class="muted">Enter your details to view balances or apply for leave. This demo talks to a local FastAPI server.</p>
      <div class="row">
        <div>
          <label>API Base URL</label>
          <input id="baseUrl" value="http://localhost:8000">
        </div>
        <div>
          <label>Client API Key (X-API-Key)</label>
          <input id="apiKey" value="DEMO-ACME-KEY-123">
        </div>
      </div>
      <div class="row">
        <div>
          <label>Employee ID</label>
          <input id="employeeId" placeholder="e.g. E001">
        </div>
        <div>
          <label>Access Code (PIN)</label>
          <input id="accessCode" placeholder="e.g. 1234">
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="flex"><span>Check Balances</span> <span class="pill">GET /leave/{employee_id}</span></h3>
      <div class="row">
        <div>
          <label>Year (optional)</label>
          <input id="year" placeholder="e.g. 2025">
        </div>
        <div style="align-self:end;">
          <button id="btnFetch">Fetch Balances</button>
        </div>
      </div>
      <pre id="balancesOutput">—</pre>
    </div>

    <div class="card">
      <h3 class="flex"><span>Check by Type</span> <span class="pill">GET /leave/{employee_id}/{leave_type}</span></h3>
      <div class="row3">
        <div>
          <label>Leave Type</label>
          <input id="leaveType" placeholder="annual / sick / unpaid">
        </div>
        <div></div>
        <div style="align-self:end;">
          <button id="btnFetchType">Fetch Type</button>
        </div>
      </div>
      <pre id="typeOutput">—</pre>
    </div>

    <div class="card">
      <h3 class="flex"><span>Apply for Leave</span> <span class="pill">POST /leave/apply</span></h3>
      <div class="row3">
        <div>
          <label>Leave Type</label>
          <input id="applyType" placeholder="annual / sick / unpaid">
        </div>
        <div>
          <label>Start Date</label>
          <input id="startDate" placeholder="YYYY-MM-DD">
        </div>
        <div>
          <label>End Date</label>
          <input id="endDate" placeholder="YYYY-MM-DD">
        </div>
      </div>
      <label>Reason (optional)</label>
      <textarea id="reason" rows="3" placeholder="Reason..."></textarea>
      <div style="margin-top:.5rem">
        <button id="btnApply">Submit Application</button>
      </div>
      <pre id="applyOutput">—</pre>
    </div>
  </div>

  <script>
    const q = (id)=>document.getElementById(id);
    function headers(){ return { "X-API-Key": q("apiKey").value, "Content-Type":"application/json" }; }

    q("btnFetch").onclick = async () => {
      const base = q("baseUrl").value.replace(/\/$/,"");
      const emp = q("employeeId").value.trim();
      const code = q("accessCode").value.trim();
      const year = q("year").value.trim();
      let url = `${base}/leave/${encodeURIComponent(emp)}?access_code=${encodeURIComponent(code)}`;
      if(year) url += `&year=${encodeURIComponent(year)}`;
      q("balancesOutput").textContent = "Loading...";
      try{
        const res = await fetch(url, { headers: headers() });
        const data = await res.json();
        q("balancesOutput").textContent = JSON.stringify(data, null, 2);
      }catch(e){
        q("balancesOutput").textContent = String(e);
      }
    };

    q("btnFetchType").onclick = async () => {
      const base = q("baseUrl").value.replace(/\/$/,"");
      const emp = q("employeeId").value.trim();
      const code = q("accessCode").value.trim();
      const t = q("leaveType").value.trim();
      let url = `${base}/leave/${encodeURIComponent(emp)}/${encodeURIComponent(t)}?access_code=${encodeURIComponent(code)}`;
      q("typeOutput").textContent = "Loading...";
      try{
        const res = await fetch(url, { headers: headers() });
        const data = await res.json();
        q("typeOutput").textContent = JSON.stringify(data, null, 2);
      }catch(e){
        q("typeOutput").textContent = String(e);
      }
    };

    q("btnApply").onclick = async () => {
      const base = q("baseUrl").value.replace(/\/$/,"");
      const payload = {
        employee_id: q("employeeId").value.trim(),
        access_code: q("accessCode").value.trim(),
        leave_type: q("applyType").value.trim(),
        start_date: q("startDate").value.trim(),
        end_date: q("endDate").value.trim(),
        reason: q("reason").value.trim() || null
      };
      q("applyOutput").textContent = "Submitting...";
      try{
        const res = await fetch(`${base}/leave/apply`, {
          method: "POST",
          headers: headers(),
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        q("applyOutput").textContent = JSON.stringify(data, null, 2);
      }catch(e){
        q("applyOutput").textContent = String(e);
      }
    };
  </script>
</body>
</html>